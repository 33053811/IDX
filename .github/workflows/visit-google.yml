export default {
  async fetch(request, env, ctx) {
    // ç›®æ ‡è®¿é—®åœ°å€
    const URL = "https://idx.google.com/us222-59187885";

    // æ¨¡æ‹Ÿ Chrome æµè§ˆå™¨ UA
    const UA =
      "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118 Safari/537.36";

    // ä»ç¯å¢ƒå˜é‡è¯»å– Cookie
    const COOKIE = env.GOOGLE_COOKIE || "";

    // å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å¾ªç¯è®¿é—®å‡½æ•°
    async function loopVisit() {
      while (true) {
        // éšæœºç­‰å¾… 1~10 åˆ†é’Ÿï¼ˆ60~600 ç§’ï¼‰
        const delay = Math.floor(Math.random() * 600 + 60);
        console.log(`â³ ç­‰å¾… ${delay} ç§’åè®¿é—® (${(delay / 60).toFixed(1)} åˆ†é’Ÿ)...`);
        await new Promise((r) => setTimeout(r, delay * 1000));

        try {
          const res = await fetch(URL, {
            method: "GET",
            headers: {
              "User-Agent": UA,
              Cookie: COOKIE,
            },
          });
          const status = res.status;
          const date = new Date().toISOString();
          console.log(`âœ… [${date}] è®¿é—®æˆåŠŸ - çŠ¶æ€ç  ${status}`);
        } catch (e) {
          console.log("âŒ è¯·æ±‚å¤±è´¥ï¼š", e.message);
        }
      }
    }

    // å¯åŠ¨å¼‚æ­¥å¾ªç¯
    ctx.waitUntil(loopVisit());

    return new Response(
      "ğŸŒ Cloudflare Worker å·²å¯åŠ¨éšæœºè®¿é—®ä»»åŠ¡ï¼ˆ1~10åˆ†é’Ÿé—´éš”å¾ªç¯ï¼‰",
      { headers: { "content-type": "text/plain;charset=UTF-8" } }
    );
  },
};
