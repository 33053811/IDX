name: Google IDX Keepalive

on:
  workflow_dispatch:
  schedule:
    - cron: '0 * * * *'  # æ¯å°æ—¶å¯åŠ¨ä¸€æ¬¡å¾ªç¯

jobs:
  keepalive:
    runs-on: ubuntu-latest
    steps:
      - name: Start infinite loop
        env:
          COOKIE: ${{ secrets.GOOGLE_COOKIE }}
        run: |
          echo "ğŸš€ å¯åŠ¨ Google IDX è‡ªåŠ¨è®¿é—®ä»»åŠ¡"
          while true; do
            # éšæœºå»¶è¿Ÿ 1ï½10 åˆ†é’Ÿ
            DELAY=$((RANDOM % 600 + 60))
            echo "â³ ç­‰å¾… $DELAY ç§’åè®¿é—®..."
            sleep $DELAY

            # å‘èµ·è¯·æ±‚å¹¶ä¿æŒ 30 ç§’è¿æ¥
            echo "ğŸŒ æ­£åœ¨è®¿é—® https://idx.google.com/us222-59187885 ..."
            curl -L -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/120 Safari/537.36" \
                 -H "Cookie: $COOKIE" \
                 --max-time 30 \
                 -I -s -w "\nçŠ¶æ€ç ï¼š%{http_code}\nå®Œæˆæ—¶é—´ï¼š%{time_total}s\n" \
                 https://idx.google.com/us222-59187885

            echo "âœ… è®¿é—®å®Œæˆï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯..."
          done
